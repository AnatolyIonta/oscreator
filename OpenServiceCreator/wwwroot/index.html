<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title></title>
</head>

<style type="text/css">
    .wrapper{
        display:grid;
        grid-template-rows: 250px 1fr;
    }
    .border{
        border: 4px solid #000000;
    }
    .body{
        display: grid;
        grid-template-columns: 300px 1fr;
    }
</style>

<body>
    <div class="wrapper">
        <div class="header border">
            <h1>OpenServiceCreator MVP 0.1</h1>
        </div>
        <div class="body" id="body">
            <div class="nav border">
                <div>
                    <h3>Сборки</h3>
                </div>
            </div>
            <div class="content border">
                <p>
                    <input type="file" name="f" id="f">
                    <input type="submit" value="Отправить" id="btn" onclick="uploadFile()">
                    <input type="button" value="Применить миграци" id="btn" onclick="applayMigration()">
                </p>
                <div id="sb">
                
                    
                
                </div>
            </div>
        </div>
    </div>
    <script async type="text/javascript">
    </script>

    <script>
        function loadAssembly() {
            fetch("/Assembly/list", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8'
                },
                body: "{}"
            }).then(async (response) => {
                if (response.ok) {
                    var json = await response.json();
                    var data = json.dtos;
                    var body = document.getElementById("sb");
                    body.innerHTML = "";
                    for (let i = 0; i < json.count; i++)
                    {
                        var element = document.createElement('div');
                        element.innerHTML = `<input type="checkbox" name="ck${i}" id="ck${i}" onclick="activateAssembly(document.getElementById('ck'+${i}).checked, ${data[i].id})"/> <label "ck${i}">${data[i].name}</label>`
                        body.appendChild(element);
                        document.getElementById(`ck${i}`).checked = data[i].isActive;
                    }
				}
            }
            );    
        }
        loadAssembly();
        function uploadFile() {
            var input = document.getElementById("f");

            var data = new FormData()
            data.append('file', input.files[0]);

            fetch('/Assembly/SaveAssembly', {
                method: 'POST',
                body: data
            }).then(e => loadAssembly());
        }
        function applayMigration() {
            fetch('/Assembly/ApplayMigration', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8'
                },
                body: '{}'
            });
        }
        function activateAssembly(state, id) {
            response = fetch("/Assembly/SetActive", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8'
                },
                body: `{"assemblyId":${id}, "isActive":${state}}`,
            });
        }
    </script>
</body>

</html>